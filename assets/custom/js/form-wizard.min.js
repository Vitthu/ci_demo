var FormWizard = function () {
    return {
        init: function () {
            function e(e) {
                return e.id ? "<img class='flag' src='../../assets/global/img/flags/" + e.id.toLowerCase() + ".png'/>&nbsp;&nbsp;" + e.text : e.text
            }
            jQuery.validator.addMethod("lettersonly", function (value, element) {
                return this.optional(element) || /^[a-z]+$/i.test(value);
            }, "Please enter letters");
            jQuery.validator.addMethod("greaterThan",
                    function (value, element, params) {

                        if (!/Invalid|NaN/.test(new Date(value))) {
                            return new Date(value) > new Date($(params).val());
                        }

                        return this.optional(element) || isNaN(value) && isNaN($(params).val())
                                || (Number(value) > Number($(params).val()));
                    }, 'Anniversary date Must be greater then Birthday .');
            if (jQuery().bootstrapWizard) {
                $("#country_list").select2({
                    placeholder: "Select",
                    allowClear: !0,
                    formatResult: e,
                    width: "auto",
                    formatSelection: e,
                    escapeMarkup: function (e) {
                        return e
                    }
                });
                var r = $("#submit_form"),
                        t = $(".alert-danger", r),
                        i = $(".alert-success", r);
                r.validate({
                    doNotHideMessage: !0,
                    errorElement: "span",
                    errorClass: "help-block help-block-error",
                    focusInvalid: !1,
                    rules: {
                        firstname: {
                            minlength: 5,
                            required: !0
                        },
                        password: {
                            minlength: 5,
                            required: !0
                        },
                        rpassword: {
                            minlength: 5,
                            required: !0,
                            equalTo: "#submit_form_password"
                        },
                        first_name: {
                            lettersonly: !0,
                            required: !0
                        },
                        last_name: {
                            lettersonly: !0,
                            required: !0
                        },
                        middle_name: {
                            lettersonly: !0
                        },
                        name_father_husband_guardian: {
                            lettersonly: !0
                        },
                        mothers_maiden_name: {
                            lettersonly: !0
                        }, gender: {
                            required: !0
                        },
                        mobile_no: {
                            digits: !0,
                            minlength: 10,
                            maxlength: 10,
                            required: !0
                        },
                        email_id: {
                            email: !0
                        },
                        birthdate: {
                            required: !0
                        },
                        anniversary_date: {
                            greaterThan: "#birthdate"
                        },
                        marital_status: {
                            required: !0
                        }, no_of_children: {
                            digits: !0,
                        },
                        religion: {
                            lettersonly: !0,
                        },
                        category: {
                            lettersonly: !0,
                        },
                        is_family: {
                            required: !0,
                        },
                        address_line1: {required: !0},
                        pincode: {
                            digits: !0,
                            required: !0,
                            minlength: 6,
                            maxlength: 6
                        },
//                        relation: {
//                            required: !0,
//                        },
                        s_occupation: {
                            required: !0,
                        }
                    },
                    messages: {
                        first_name: {
                            required: "Enter First Name"
                        },
                        last_name: {
                            required: "Enter Last Name"
                        },
                        gender: {
                            required: "Select Gender"
                        },
                        mobile_no: {
                            required: "Enter  Mobile Number"
                        },
                        birthdate: {
                            required: "Select BirthDate"
                        },
                        marital_status: {
                            required: "Select Marital Status"
                        },
                        address_line1: {
                            required: "Enter Address"
                        },
                        pincode: {
                            required: "Enter Postel Code"
                        },
                        is_family: {
                            required: "Please Select Option"
                        },
//                        relation: {
//                            required: "Select Family Member"
//                        },
                        s_occupation: {
                            required: "Select Occupation"
                        }
                    },
                    errorPlacement: function (e, r) {
                        "gender" == r.attr("name") ? e.insertAfter("#form_gender_error") : "is_family" == r.attr("name") ? e.insertAfter("#form_isfamily_error") : "payment[]" == r.attr("name") ? e.insertAfter("#form_payment_error") : e.insertAfter(r)
                    },
                    invalidHandler: function (e, r) {
                        i.hide(), t.show(), App.scrollTo(t, -200)
                    },
                    highlight: function (e) {
                        $(e).closest(".form-group").removeClass("has-success").addClass("has-error")
                    },
                    unhighlight: function (e) {
                        $(e).closest(".form-group").removeClass("has-error")
                    },
                    success: function (e) {
                        "gender" == e.attr("for") || "payment[]" == e.attr("for") ? (e.closest(".form-group").removeClass("has-error").addClass("has-success"), e.remove()) : e.addClass("valid").closest(".form-group").removeClass("has-error").addClass("has-success")
                    },
                    submitHandler: function (e) {
                        i.show(), t.hide()
                    }
                });
                var a = function () {
                    $("#tab4 .form-control-static", r).each(function () {
                        var e = $('[name="' + $(this).attr("data-display") + '"]', r);
                        if (e.is(":radio") && (e = $('[name="' + $(this).attr("data-display") + '"]:checked', r)), e.is(":text") || e.is("textarea"))
                            $(this).html(e.val());
                        else if (e.is("select"))
                            $(this).html(e.find("option:selected").text());
                        else if (e.is(":radio") && e.is(":checked"))
                            $(this).html(e.attr("data-title"));
                        else if ("payment[]" == $(this).attr("data-display")) {
                            var t = [];
                            $('[name="payment[]"]:checked', r).each(function () {
                                t.push($(this).attr("data-title"))
                            }), $(this).html(t.join("<br>"))
                        }
                    })
                },
                        o = function (e, r, t) {
                            var i = r.find("li").length,
                                    o = t + 1;
                            $(".step-title", $("#form_wizard_1")).text("Step " + (t + 1) + " of " + i), jQuery("li", $("#form_wizard_1")).removeClass("done");
                            for (var n = r.find("li"), s = 0; t > s; s++)
                                jQuery(n[s]).addClass("done");
                            1 == o ? $("#form_wizard_1").find(".button-previous").hide() : $("#form_wizard_1").find(".button-previous").show(), o >= i ? ($("#form_wizard_1").find(".button-next").hide(), $("#form_wizard_1").find(".button-submit").show(), a()) : ($("#form_wizard_1").find(".button-next").show(), $("#form_wizard_1").find(".button-submit").hide()), App.scrollTo($(".page-title"))
                        };
                $("#form_wizard_1").bootstrapWizard({
                    nextSelector: ".button-next",
                    previousSelector: ".button-previous",
                    onTabClick: function (e, r, t, i) {
                        return !1
                    },
                    onNext: function (e, a, n) {
                        return i.hide(), t.hide(), 0 == r.valid() ? !1 : void o(e, a, n)
                    },
                    onPrevious: function (e, r, a) {
                        i.hide(), t.hide(), o(e, r, a)
                    },
                    onTabShow: function (e, r, t) {
                        var i = r.find("li").length,
                                a = t + 1,
                                o = a / i * 100;
                        $("#form_wizard_1").find(".progress-bar").css({
                            width: o + "%"
                        })
                    }
                }), $("#form_wizard_1").find(".button-previous").hide(), $("#form_wizard_1 .button-submit").click(function () {
                    var name = $('#firstname').val();
                    var table1 = {};
                    $("#family_table tbody tr").each(function (row, tr) {
                        var member = $(tr).find('td:eq(0)').attr('id');
                        console.log(member);
                        table1[row] = {member: member};
                        console.log(table1);
                    });
                    table1 = JSON.stringify(table1);
                    $("#family_data").val(table1);
                    
                    $.ajax({
                        type: 'POST',
                        url: "http://localhost:8080/lokmanya_crm/customer/addNewCustomer",
                     //  url: "http://188.95.36.67:86lokmanya_crm/customer/addNewCustomer",
                        data: $("#submit_form").serialize(),
                        dataType: "json",
                        success: function (res) {
                             $("#flash2").show();
                            if (res.success) {

//                                window.location.href = 'http://localhost:8080/lokmanya_crm/customer/customerDetails/' + res.customer_id;
                                window.location.href = 'http://localhost:8080/lokmanya_crm/customer';
                               // window.location.href = 'http://188.95.36.67:86/lokmanya_crm/customer';
                            }
                            if (res.error) {
                                alert(res.error)
                                $("#flash3").show();
                                $("#flash3").html("<div class='alert alert-danger'>" + res.error + "<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>");
                                $("#flash3").delay(4000).fadeOut(300);
                                $("#mobile_no").focus();
                            }
                        }
                    });
                    return false;


                    alert(name + "Finished! Hope you like it :)")
                }).hide(), $("#country_list", r).change(function () {
                    r.validate().element($(this));
                });
            }
        }
    }
}();
jQuery(document).ready(function () {
    FormWizard.init()
});